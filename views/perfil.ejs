<head>
    <meta charset="UTF-8">
    <title>Footlaces | Perfil</title>
    
    <link rel="stylesheet" href="/stylesheets/perfil.css"> <!-- este -->
  </head>

<%- include("header", { user: user }) %>

<div class="perfil-container">
  <div class="sidebar">
    <ul>
      <li><strong>üìä Panel de control</strong></li>
      <li>üìç Direcciones (<%= numDirecciones || 0 %>)</li>
      <li>üíñ Lista de deseos (0)</li>
      <li><a href="/logout" class="logout">‚Ü© Cerrar sesi√≥n</a></li>
    </ul>
  </div>

  <div class="perfil-main">
    <div class="resumen-cajas">
      <div class="caja">
        <h4>Total Comprado</h4>
        <p><%= totalGastado?.toFixed(2) || "0.00" %>‚Ç¨</p>
      </div>
      <div class="caja">
        <h4>N√∫mero de Pedidos</h4>
        <p><%= numPedidos || 0 %></p>
      </div>
      <div class="caja">
        <h4>Direcciones</h4>
        <p><%= numDirecciones || 0 %></p>
      </div>
    </div>
    
    <h2>Detalles de la cuenta</h2>
    <table>
      <tr><td><strong>Nombre:</strong></td><td><%= user.nombre %></td></tr>
      <tr><td><strong>Correo electr√≥nico:</strong></td><td><%= user.email %></td></tr>
      <tr>
        <td><strong>Direcci√≥n 1:</strong></td>
        <td>
          <% if (user.direcciones?.[0]) { %>
            <%= user.direcciones[0].linea1 %>, <%= user.direcciones[0].ciudad %>, <%= user.direcciones[0].provincia %>, <%= user.direcciones[0].pais %>, <%= user.direcciones[0].codigoPostal %>
          <% } else { %> Sin registrar <% } %>
        </td>
      </tr>
      <tr>
        <td><strong>Direcci√≥n 2:</strong></td>
        <td>
          <% if (user.direcciones?.[1]) { %>
            <%= user.direcciones[1].linea1 %>, <%= user.direcciones[1].ciudad %>, <%= user.direcciones[1].provincia %>, <%= user.direcciones[1].pais %>, <%= user.direcciones[1].codigoPostal %>
          <% } else { %> Sin registrar <% } %>
        </td>
      </tr>
    </table>

    <h2>Historial de pedidos</h2>
    <% if (!pedidos || pedidos.length === 0) { %>
      <p>‚úÖ <a href="/sneakers">Haz tu primer pedido</a> ‚Äî No has hecho ning√∫n pedido a√∫n.</p>
    <% } else { %>
      <% pedidos.forEach(pedido => { %>
        <div class="pedido-box">
          <p><strong>Fecha:</strong> <%= pedido.fecha %></p>
          <p><strong>Estado:</strong> <%= pedido.estado %></p>
          <p><strong>Total:</strong> <%= pedido.total?.toFixed(2) || "0.00" %>‚Ç¨</p>


          <% pedido.productos.forEach(p => { %>
            <div class="producto-card">
              <img src="<%= p.producto.imagenes[0] %>" width="100">
              <p><%= p.producto.nombre %></p>
              <p>Talla: <%= p.talla %></p>
              <p>Cantidad: <%= p.cantidad %></p>
              <p>Precio: <%= p.precio %>‚Ç¨</p>
            </div>
          <% }); %>          
          </div>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>
